---
import { ModeToggle } from "@/components/ModeToggle";
import "../../styles/global.css";
import { MainTabs } from "@/components/MainTabs";
import GitHub from "@/components/icons/GitHub.astro";
import Twitter from "@/components/icons/Twitter.astro";
import LinkedIn from "@/components/icons/LinkedIn.astro";
import Cal from "@/components/icons/Cal.astro";
import { HoverPic } from "@/components/HoverPic";
import Sponsors from "@/components/Sponsors.astro";
import { LanguageToggle } from "@/components/LanguageToggle";
import { GitHubButton } from "@/components/GitHubButton";
import { cn } from "@/lib/utils";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/ico" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    
    <!-- Font preloading for better performance -->
    <link rel="preload" href="/fonts/Gambarino-Regular.woff2" as="font" type="font/woff2" crossorigin />
    
    <title>{t('site.title')}</title>
    <meta name="description" content={t('site.description')} />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://dominikkoch.dev/de/" />
    <meta property="og:title" content={t('site.title')} />
    <meta property="og:description" content={t('site.description')} />
    <meta property="og:image" content="https://dominikkoch.dev/images/me.webp" />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary" />
    <meta property="twitter:url" content="https://dominikkoch.dev/de/" />
    <meta property="twitter:title" content={t('site.title')} />
    <meta property="twitter:description" content={t('site.description')} />
    <meta property="twitter:image" content="https://dominikkoch.dev/images/me.webp" />
    <meta name="author" content="Dominik Koch" />
    <meta name="theme-color" content="#FDC700" />
    <link rel="sitemap" href="/sitemap-index.xml" />
    
    <!-- Canonical and hreflang tags - English is canonical -->
    <link rel="canonical" href="https://dominikkoch.dev/en/" />
    <link rel="alternate" hreflang="en" href="https://dominikkoch.dev/en/" />
    <link rel="alternate" hreflang="de" href="https://dominikkoch.dev/de/" />
    <link rel="alternate" hreflang="x-default" href="https://dominikkoch.dev/" />

    <!-- DataDaddy Analytics -->
    <script is:inline
      src="https://app.databuddy.cc/databuddy.js"
      data-client-id="T7Oky9JBa87U0MJjqmRkH"
      data-track-web-vitals="true"
      data-track-errors="true"
      data-enable-batching="true"
      crossorigin="anonymous"
      async
    />
    
    <style>
      .precise-age {
        font-family: monospace;
        display: inline-block;
        min-width: 12ch;
      }
      h1 {
        font-family: "Gambarino", serif;
      }
      .grid-bg {
        will-change: mask-image;
        --mouse-x: 50%;
        --mouse-y: 50%;
      }
    </style>
  </head>

  <body>
    <div
      class="relative min-h-screen w-full bg-white dark:bg-black overflow-hidden"
    >
      <div
        class={cn(
          "fixed inset-0 grid-bg",
          "[background-size:20px_20px]",
          "[background-image:radial-gradient(#d4d4d4_1px,transparent_1px)]",
          "dark:[background-image:radial-gradient(#404040_1px,transparent_1px)]"
        )}
        style="mask-image: radial-gradient(circle 200px at var(--mouse-x) var(--mouse-y), transparent 0%, transparent 30%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.8) 100%), radial-gradient(circle 400px at var(--mouse-x) var(--mouse-y), rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.9) 100%)"
      >
      </div>
      <div
        class={cn(
          "fixed inset-0 pointer-events-none",
          "[background-size:20px_20px]",
          "[background-image:radial-gradient(#3b82f6_1px,transparent_1px)]",
          "dark:[background-image:radial-gradient(#60a5fa_1px,transparent_1px)]"
        )}
        style="mask-image: radial-gradient(circle 200px at var(--mouse-x) var(--mouse-y), black 0%, rgba(0,0,0,0.8) 40%, rgba(0,0,0,0.2) 70%, transparent 100%)"
      >
      </div>
      <div
        class="pointer-events-none fixed inset-0 bg-white [mask-image:radial-gradient(ellipse_at_center,transparent_20%,black)] dark:bg-black"
      >
      </div>

      <main
        class="text-zinc-900 dark:text-zinc-100 max-w-xl mx-auto px-4 py-4 mt-16 relative z-10"
      >
        <section class="flex flex-col gap-4 mb-8">
          <div class="flex items-center justify-between">
            <HoverPic client:load>
              <h1 class="text-2xl font-medium tracking-tight">
                {t('intro.hi')}
              </h1>
            </HoverPic>
            <div class="flex items-center gap-4">
              <GitHubButton client:load />
              <LanguageToggle client:load />
              <ModeToggle client:load />
            </div>
          </div>
          <p class="text-md">
            {t('intro.description')} <span
              id="age"
              class="precise-age">ü§®</span
            > {t('intro.years')} <span class=" relative after:absolute after:bg-yellow-400 after:bottom-0 after:left-0 after:h-[2px] after:w-full after:origin-left after:scale-x-0 hover:after:scale-x-100 after:transition-transform after:duration-300 after:ease-in-out"
              >{t('intro.engineer')}</span
            > {t('intro.working')} <a
              href="https://rivo.gg/"
              target="_blank"
              class="font-bold relative after:absolute after:bg-zinc-900 dark:after:bg-zinc-100 after:bottom-0 after:left-0 after:h-[2px] after:w-full after:origin-left after:scale-x-0 hover:after:scale-x-100 after:transition-transform after:duration-300 after:ease-in-out">Rivo</a
            > und <a
              href="https://wouldyoubot.gg/"
              target="_blank"
              class="font-bold relative after:absolute after:bg-zinc-900 dark:after:bg-zinc-100 after:bottom-0 after:left-0 after:h-[2px] after:w-full after:origin-left after:scale-x-0 hover:after:scale-x-100 after:transition-transform after:duration-300 after:ease-in-out">Would You Bot</a
            >.
          </p>
          <div class="flex flex-row gap-4">
            <a
              href="https://cal.com/dominikkoch"
              target="_blank"
              class="overflow-hidden transition-all text-zinc-900/60 dark:text-zinc-100/60 hover:text-zinc-900/100 dark:hover:text-zinc-100/100"
            >
              <p class="sr-only">Cal.com</p>
              <Cal class="h-5 w-5 transition-all" />
            </a>
            <a
              href="https://github.com/mezotv"
              target="_blank"
              class="overflow-hidden transition-all text-zinc-900/60 dark:text-zinc-100/60 hover:text-zinc-900/100 dark:hover:text-zinc-100/100"
            >
              <p class="sr-only">GitHub</p>
              <GitHub class="h-5 w-5 transition-all" />
            </a>
            <a
              href="https://twitter.com/dominikdoesdev"
              target="_blank"
              class="overflow-hidden transition-all text-zinc-900/60 dark:text-zinc-100/60 hover:text-zinc-900/100 dark:hover:text-zinc-100/100"
            >
              <p class="sr-only">Twitter</p>
              <Twitter class="h-5 w-5 transition-all" />
            </a>
            <a
              href="https://linkedin.com/in/dominikkoch"
              target="_blank"
              class="overflow-hidden transition-all text-zinc-900/60 dark:text-zinc-100/60 hover:text-zinc-900/100 dark:hover:text-zinc-100/100"
            >
              <p class="sr-only">LinkedIn</p>
              <LinkedIn class="h-5 w-5 transition-all" />
            </a>
          </div>
        </section>
        <MainTabs client:load lang={lang} />
        <section class="mt-8">
          <Sponsors />
        </section>
      </main>
      <footer class="mt-8 relative z-50">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between items-center gap-2 sm:gap-0 max-w-xl mx-auto px-4 py-4 text-center sm:text-left">
          <p class="text-zinc-900 dark:text-muted-foreground text-sm">
            {t('footer.made')} <span class="text-red-500 dark:text-red-400">‚ù§Ô∏è</span> {t('footer.by')} <span class="font-bold text-black/90 dark:text-zinc-100">Dominik Koch</span>
          </p>
          <p class="text-zinc-900 dark:text-muted-foreground text-sm">
            {t('footer.inspired')} <a
              href="https://ahmet.studio"
              target="_blank"
              rel="noopener noreferrer"
              class="font-bold text-black/90 dark:text-zinc-100 relative after:absolute after:bg-zinc-900 dark:after:bg-zinc-100 after:bottom-0 after:left-0 after:h-[2px] after:w-full after:origin-left after:scale-x-0 hover:after:scale-x-100 after:transition-transform after:duration-300 after:ease-in-out"
            >Ahmet Kilinc</a>!
          </p>
        </div>
      </footer>
    </div>

    <script is:inline>
      const getThemePreference = () => {
        if (
          typeof localStorage !== "undefined" &&
          localStorage.getItem("theme")
        ) {
          return localStorage.getItem("theme");
        }
        return window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "light";
      };
      const isDark = getThemePreference() === "dark";
      document.documentElement.classList[isDark ? "add" : "remove"]("dark");

      if (typeof localStorage !== "undefined") {
        const observer = new MutationObserver(() => {
          const isDark = document.documentElement.classList.contains("dark");
          localStorage.setItem("theme", isDark ? "dark" : "light");
        });
        observer.observe(document.documentElement, {
          attributes: true,
          attributeFilter: ["class"],
        });
      }

      // Mouse cursor effect for grid background
      let mouseX = 0;
      let mouseY = 0;
      let targetX = 0;
      let targetY = 0;
      let isAnimating = true;
      const FRAME_TIME_MS = 16
      
      // Throttle mouse updates for better performance
      let lastMouseUpdate = 0;
      function updateMousePosition(e) {
        const now = performance.now();
        if (now - lastMouseUpdate > FRAME_TIME_MS) { // Limit to ~60fps
          targetX = (e.clientX / window.innerWidth) * 100;
          targetY = (e.clientY / window.innerHeight) * 100;
          lastMouseUpdate = now;
        }
      }
      
      function animateGrid() {
        if (!isAnimating) return;
        
        mouseX += (targetX - mouseX) * 0.1;
        mouseY += (targetY - mouseY) * 0.1;
        
        const gridBgs = document.querySelectorAll('.grid-bg, .grid-bg + div');
        gridBgs.forEach(bg => {
          bg.style.setProperty('--mouse-x', `${mouseX}%`);
          bg.style.setProperty('--mouse-y', `${mouseY}%`);
        });
        
        requestAnimationFrame(animateGrid);
      }
      
      window.addEventListener('mousemove', updateMousePosition, { passive: true });
      
      // Pause animation when tab is not visible for better performance
      document.addEventListener('visibilitychange', () => {
        isAnimating = !document.hidden;
        if (isAnimating) animateGrid();
      });
      
      animateGrid();
    </script>

    <script>
      function updateAge() {
        const birthday = new Date("2005-01-17T11:12:00+01:00").getTime();
        const now = performance.now() + performance.timeOrigin;
        const ageInMs = now - birthday;
        const ageInYears = ageInMs / (1000 * 60 * 60 * 24 * 365.25);
        const ageElement = document.getElementById("age");
        if (ageElement) {
          ageElement.textContent = ageInYears.toFixed(11);
        }
        requestAnimationFrame(updateAge);
      }
      updateAge();
    </script>
  </body>
</html> 